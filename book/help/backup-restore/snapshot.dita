<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE task PUBLIC "urn:pubid:zenoss.com:doctypes:dita:dtd:task" "task.dtd">
<task id="taskid">
  <title>Taking a snapshot</title>
  <shortdesc>Snapshots are a time- and space-efficient method of copying data. The main advantage of
    taking a snapshot over a backup is that you do not have to stop any services when taking a
    snapshot. You can take a snapshot whenever you need a save point for your Docker image, such as
    before committing container changes.</shortdesc>
  <taskbody>
    <context>When you take a snapshot, <ph keyref="nm-cc"/> creates a tag for the Docker image of
      each service and takes a backup of the distributed file system. If you want to back out
      changes made to an application, you can use the rollback functionality to go back to the
      snapshot image.<p>Snapshots are intended to serve as short-term save points only, and
        therefore have a default time-to-live (TTL) value of 12 hours. If you need to keep a
        snapshot beyond the TTL, tag the snapshot to prevent it from being deleted after the TTL
        expires. For data that you need to save long-term, (historical backup), take full backups
        instead of snapshots. </p><p>
        <ph keyref="nm-cc"/> uses <i>thin provisioning</i>, which enables it to take snapshots of
        the application data volume. Thin provisioning is a virtualization method that allocates
        data blocks only when data is written (copy-on-write). Because snapshots track changes to
        the file system over time, their space requirements expand incrementally as application data
        changes. Application data and snapshots share the same base device; therefore, ensure that
        snapshots do not fill up the base device storage. For information about extending storage,
        see <xref keyref="help-admin-extend"/>.</p>
    </context>
    <steps>
      <step>
        <cmd>Log in to the <ph keyref="nm-cc"/> host as a user with <cmdname>sudo</cmdname> and
            <cmdname>docker</cmdname> privileges.</cmd>
      </step>
      <step>
        <cmd>To take a snapshot of a service, you must know its identifier; for example,
              <ph><filepath>Zenoss.resmgr</filepath></ph>. To find the identifier, execute the
          following command:</cmd>
        <stepxmp>
          <codeblock>serviced service list</codeblock>
        </stepxmp>
      </step>
      <step>
        <cmd>Take the snapshot. Replace <varname>SERVICEID</varname> with the identifier of the
          service.</cmd>
        <stepxmp>
          <codeblock>serviced snapshot add <varname>SERVICEID</varname></codeblock>
        </stepxmp>
        <stepresult>The identifier of the snapshot is displayed.</stepresult>
      </step>
      <step>
        <cmd importance="optional">Verify the existence of the snapshot:</cmd>
        <stepresult>
          <codeblock>serviced snapshot list</codeblock>
        </stepresult>
      </step>
      <step>
        <cmd importance="optional">To keep the snapshot for longer than the default 12-hour TTL, tag
          it by executing the following command. Replace <varname>SNAPSHOTID</varname> with the
          identifier of your snapshot and <varname>TAG-NAME</varname> with your tag.</cmd>
        <stepxmp>
          <codeblock>serviced snapshot tag <varname>SNAPSHOTID</varname> <varname>TAG-NAME</varname></codeblock>
        </stepxmp>
      </step>
      <step>
        <cmd importance="optional">To untag a snapshot, making it subject to the TTL value, execute
          the following command:</cmd>
        <stepresult>
          <codeblock>serviced snapshot untag <varname>SNAPSHOTID</varname> <varname>TAG-NAME</varname></codeblock>
        </stepresult>
      </step>
    </steps>
  </taskbody>
</task>
