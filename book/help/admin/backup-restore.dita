<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE reference PUBLIC "urn:pubid:zenoss.com:doctypes:dita:dtd:reference" "reference.dtd">
<reference id="referenceid">
  <title>Backing up and restoring</title>
  <shortdesc>Use <ph keyref="nm-cc"/> to back up an application that <ph keyref="nm-cc"/> manages.
    Having accurate and tested system backups can mitigate problems caused by software or hardware
    issues. The <ph keyref="nm-cc"/> backup process creates a compressed archive file
      (<filepath>.tgz</filepath>) that can be restored on the same cluster or a similar
    cluster.</shortdesc>
  <refbody>
    <section>
      <p>Backups include the current state of the system, the state of all services, configuration
        information, and application data. <!-- CC-306 --> The backup process leverages snapshot
        functionality. Therefore, when a backup is running, you can start and restart services;
        there is no need to shut down the application container or the Docker containers. The
        services are only momentarily suspended to enable reading the data.</p>
      <p>When a full backup is not necessary, such as when you need a checkpoint before installing
        software, you can perform a snapshot of the system. If you need to revert back to a
        snapshot, use the rollback feature. You use the CLI to perform snapshot and rollback. For
        more information about using the CLI, see <xref keyref="feature-cli-cli"/>.</p>
      <p>With both backup and snapshot, <ph keyref="nm-cc"/>
        <ul id="ul_iyk_cq1_jx">
          <li>creates a tag for the Docker image of each service with metadata about the data</li>
          <li>takes a separate snapshot of the LVM thin pool, which stores both application data and
            snapshots of the data</li>
        </ul>When you take a backup, <ph keyref="nm-cc"/> also exports the snapshots to an archive
        file and moves them out of the LVM thin pool. Backups do not affect TTL.</p>
      <note product="cc open">Review considerations and best practices that apply to application
        backup and restore:<ul id="ul_dqb_hrg_lx">
          <li>Ensure that you have enough free space to receive and store backups; running low on
            available disk space results in errors and affects system performance.</li>
          <li>Before undertaking the following actions, ensure that you have a recent backup that
            successfully restores: <ul id="ul_smb_qmy_fx">
              <li>Upgrading</li>
              <li>Testing</li>
              <li>Using a temporary VM or DR site</li>
            </ul></li>
          <li>Perform regular backups of the production environment and potentially the system of
            record from the initial deployment. Back up to nonactive resource targets such as a
            separate DR system or test environment. Store backups on a machine other than the <ph
              keyref="nm-cc"/> master. Copy or migrate backups to an off-system location for
            safekeeping and to help regulate storage space usage on the master.</li>
          <li>Backups that were taken using <ph keyref="nm-cc"/> 1.0.x cannot be restored in <ph
              keyref="nm-cc"/> 1.1.x or later.</li>
          <li><!-- CC-282 -->If you manually deleted the default pool, you cannot restore from a
            backup. The default pool is created on startup and is required.</li>
          <li>You can restore a backup to the system on which it was taken or to an alternate
            system. The system on which you restore any backup must mirror at least one device from
            the production system.</li>
          <li>Frequently test restoring from a backup to ensure that the backup restores
            successfully, and that the restored system is an accurate representation of the state of
            the deployment when the backup was performed.</li>
          <li><!--CC_695-->Restoring from a backup file does not remove services that were added
            after taking the backup. That is, if you take a backup, add a service, and then restore
            from the backup, the service is not deleted as part of the restore process.</li>
          <li><!-- CC-1474 -->If an outage occurs during a restore from a backup, you can resume the
            restore. <ph keyref="nm-cc"/> preserves complete data on your system. For example, if
            two of six backed up snapshots are restored before an outage, when you resume the
            restore, those two snapshots are saved on the system, and are not downloaded again.</li>
        </ul></note>
      <p>Use the browser interface or the command-line interface (CLI) to back up and restore. Both
        methods provide comparable results; however, the CLI command offers an option to exclude
        subdirectories from the backup.</p>
    </section>
  </refbody>
</reference>
