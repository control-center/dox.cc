<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE task PUBLIC "urn:pubid:zenoss.com:doctypes:dita:dtd:task" "task.dtd">
<task id="taskid">
  <title>Updating the ZooKeeper image on ensemble nodes that do not have internet access</title>
  <taskbody>
    <prereq>Before performing this procedure, review the information in the following table to
      determine whether it is necessary. <table conkeyref="cc-upgrade-paths-images/images">
        <tgroup cols="3">
          <tbody>
            <row>
              <entry/>
              <entry/>
              <entry/>
            </row>
          </tbody>
        </tgroup>
      </table>
      <ul>
        <li>If the tags of the ZooKeeper images are the same for the micro upgrade you are
          performing, skip this procedure.</li>
        <li>If the tags of the ZooKeeper images are not the same, and you are a <ph
            conkeyref="names/company"/> customer, perform this procedure.</li>
      </ul>
      <p><b><ph conkeyref="names/company"/> customers</b>: Perform the steps in <xref
        keyref="cc-feature-offline-offline"/> before performing this procedure.</p>
    </prereq>
    <context>Use this procedure to install a new Docker Engine image for
      ZooKeeper on ZooKeeper ensemble nodes that do not have internet access. 
      <ph keyref="nm-cc"/> pulls the required image from Docker Hub on
      ZooKeeper ensemble nodes that have internet access.
    <p>Perform the following steps:</p>
    </context>
    <steps>
      
      <step>
        <cmd>Log in to the master host <ph conkeyref="strings/login-root"/>.</cmd>
      </step>
      
      <step>
        <cmd>Identify the hosts in the ZooKeeper ensemble.</cmd>
        <stepxmp>
          <codeblock>grep -E '^\b*SERVICED_ZK=' /etc/default/serviced</codeblock>
        </stepxmp>
        <stepresult>The result is a list of 3 or 5 hosts, separated by 
          the comma character (<codeph>&#44;</codeph>). The master host
          is always a node in the ZooKeeper ensemble.</stepresult>
      </step>
      
      <step>
        <cmd>Log in to a ZooKeeper ensemble node <ph conkeyref="strings/login-root"/>.</cmd>
      </step>
      
      <step>
        <cmd>Change directory to <filepath>/root</filepath>.</cmd>
        <stepxmp>
          <codeblock>cd /root</codeblock>
        </stepxmp>
      </step>
      
      <step>
        <cmd>Extract the ZooKeeper image.</cmd>
        <stepxmp>
          <codeblock>./install-zenoss-isvcs-zookeeper:v*.run</codeblock>
        </stepxmp>
        <info>Image extraction begins when you press the <b>y</b> key.</info>
      </step>

      <step importance="optional">
        <cmd>Delete the archive file.</cmd>
        <stepxmp>
          <codeblock>rm -i ./install-zenoss-isvcs-zookeeper:v*.run</codeblock>
        </stepxmp>
      </step>
      
      <step>
        <cmd>Repeat the preceding four steps on each ZooKeeper node in the ensemble.</cmd>
      </step>
    </steps>
  </taskbody>
</task>
