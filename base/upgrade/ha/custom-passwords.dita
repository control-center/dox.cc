<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE task PUBLIC "urn:pubid:zenoss.com:doctypes:dita:dtd:task" "task.dtd">
<task id="taskid">
  <title>Managing custom MariaDB passwords</title>
  <taskbody>
    <context>If you are using custom database passwords for the <codeph>mariadb-events</codeph> 
      and <codeph>mariadb-model</codeph> services, the passwords must be managed before 
      starting the update process for this release. To determine whether custom passwords
      are in use, follow these steps:
    <ol>
      <li>Use the virtual hostname or virtual IP address of the high-availability cluster to log
        in to the <ph keyref="nm-cc"/> master node as a user with <cmdname>serviced</cmdname> CLI privileges.</li>
      <li>Display the MariaDB passwords.
        <codeblock>serviced service list Zenoss.resmgr | awk '/(zep|zodb).*-password/'</codeblock>
        When the default passwords are in use, the result looks like this: 
        <codeblock>"global.conf.zep-admin-password": "",
"global.conf.zep-password": "zenoss",
"global.conf.zodb-admin-password": "",
"global.conf.zodb-password": "zenoss",</codeblock>        
      </li>
    </ol>
    </context>
    
    <prereq>To perform this procedure, you need:
      <ul>
        <li>A workstation with internet access.</li>
        <li>Permission to download files from <xref keyref="url-leapfile"/>. Customers can request
          permission by filing a ticket at <ph conkeyref="names/support-site"/>.</li>
        <li>A secure network copy program.</li>
      </ul>
      <note>In addition, <ph keyref="nm-rm"/> must be running normally.</note>
      To maintain customized MariaDB passwords before updating <ph keyref="nm-rm"/>, follow these steps:
    </prereq>

    <steps>
      <step>
        <cmd>In a web browser, navigate to <xref keyref="url-leapfile"/>, and then log in.</cmd>
      </step>
      <step>
        <cmd>Download the <filepath>addGlobalConfToMariadb.py</filepath> script.</cmd>
        <info>The script is located in the <filepath>resource-manager-65x</filepath> folder.</info>
      </step>
      <step>
        <cmd>Use a network copy utility to copy the script to the <ph keyref="nm-cc"/> master node.
        </cmd>
      </step>
      <step>
        <cmd>Log in to the <ph keyref="nm-cc"/> master node as a user with <cmdname>serviced</cmdname> CLI privileges.</cmd>
      </step>
      <step>
        <cmd>Create a variable for the ID of the Zope/0 container.</cmd>
        <stepxmp>
          <codeblock>zope0=$(docker container ls --no-trunc --format "{{.ID}} {{.Command}}" \
  | awk '/runzope/ { if ($4 == "0" &#38;&#38; $9 !~ "CONFIG") print $1 }') \
  &#38;&#38; echo $zope0</codeblock>
        </stepxmp>
      </step>
      <step>
        <cmd>Copy the script to the temporary directory of the Zope/0 container.</cmd>
        <stepxmp>
          <codeblock>docker cp addGlobalConfToMariadb.py ${zope0}:/tmp</codeblock>
        </stepxmp>
      </step>
      <step>
        <cmd>Start an interactive session in the Zope/0 container as user <codeph>zenoss</codeph>.</cmd>
        <stepxmp>
          <codeblock>serviced service attach zope/0 su - zenoss</codeblock>
        </stepxmp>
      </step>
      <step>
        <cmd>Change directory to the migration directory.</cmd>
        <stepxmp>
          <codeblock>cd /opt/zenoss/Products/ZenModel/migrate</codeblock>
        </stepxmp>
      </step>
      <step>
        <cmd>Copy the <filepath>addGlobalConfToMariadb.py</filepath> script from the temporary directory.</cmd>
        <stepxmp>
          <codeblock>cp /tmp/addGlobalConfToMariadb.py .</codeblock>
        </stepxmp>
      </step>
      <step>
        <cmd>Migrate the passwords.</cmd>
        <info>
          <ul>
            <li><b>To migrate 6.3.2 systems:</b>
              <codeblock>zenmigrate --step=AddGlobalConfToMariadb --dont-bump</codeblock>
            </li>
            <li><b>To migrate 6.4.x systems:</b>
              <codeblock>zenmigrate --step=AddGlobalConfToMariadb</codeblock>
            </li>
          </ul>
        </info>
      </step>
      <step>
        <cmd>Exit the container.</cmd>
        <stepxmp>
          <codeblock>exit</codeblock>
        </stepxmp>
      </step>
    </steps>
  </taskbody>
</task>







