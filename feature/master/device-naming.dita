<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE task PUBLIC "urn:pubid:zenoss.com:doctypes:dita:dtd:task" "task.dtd">
<task id="taskid">
  <title>Disabling consistent network device naming</title>
  <taskbody>
    <context>The consistent network device naming feature can create device names that
      are too long for use with virtual IPs. This step disables the feature
      so that all network device names are <codeph>eth</codeph> followed by an integer.</context>
    <steps>
      <step>
        <cmd>Log in <ph conkeyref="strings/login-root"/>.</cmd>
      </step>
      
      <step>
        <cmd>Edit the GRUB 2 general settings file.</cmd>
        <substeps>
          <substep>
            <cmd>Create a backup copy of the settings file.</cmd>
            <stepxmp>
              <codeblock>cp /etc/default/grub /etc/default/grub.bak</codeblock>
            </stepxmp>
          </substep>
          <substep>
            <cmd>Open <filepath>/etc/default/grub</filepath> with a text editor.</cmd>
          </substep>
          <substep>
            <cmd>Add kernel boot arguments to the value of the 
              <varname>GRUB_CMDLINE_LINUX</varname> variable.</cmd>
            <info>The arguments to add are <codeph>biosdevname=0</codeph> 
              and <codeph>net.ifnames=0</codeph>. Make sure the arguments
              are between the delimiter characters (<codeph>"</codeph>).</info>
          </substep>
          <substep>
            <cmd>Save the file, and then close the text editor.</cmd>
          </substep>
        </substeps>
      </step>

      <step>
        <cmd>Determine whether the host is configured for
          UEFI or legacy boot mode.</cmd>
        <stepxmp>
          <codeblock>find /boot -maxdepth 1 -type d</codeblock>
        </stepxmp>
        <stepresult>
          <ul>
            <li>If the output includes <filepath>/boot/efi</filepath>, 
              the host is configured for UEFI boot mode.</li>
            <li>If the output does not include <filepath>/boot/efi</filepath>, 
              the host is configured for legacy boot mode.</li>
          </ul>
        </stepresult>
      </step>
      
      <step>
        <cmd>Recreate the GRUB 2 boot configuration file.</cmd>
        <stepxmp><b>For UEFI boot mode</b>:
          <codeblock>grub2-mkconfig -o /boot/efi/EFI/centos/grub.cfg</codeblock>
        </stepxmp>
        <stepxmp><b>For legacy boot mode</b>:
          <codeblock>grub2-mkconfig -o /boot/grub2/grub.cfg</codeblock>
        </stepxmp>
      </step>
      
      <step>
        <cmd>Create an override for the default rules policy 
          of the dynamic device management daemon.</cmd>
        <stepxmp>
          <codeblock>ln -s /dev/null /etc/udev/rules.d/80-net-name-slot.rules</codeblock>
        </stepxmp>
      </step>
      
      <step>
        <cmd>Change network device configurations.</cmd>
        <substeps>
          <substep>
            <cmd>Change directory to <filepath>/etc/sysconfig/network-scripts</filepath>.</cmd>
            <stepxmp>
              <codeblock>cd /etc/sysconfig/network-scripts</codeblock>
            </stepxmp>
          </substep>
          <substep>
            <cmd>List the network device configuration files.</cmd>
            <stepxmp>
              <codeblock>ls ifcfg-* | grep -v ifcfg-lo</codeblock>
            </stepxmp>
            <info>The <filepath>ifcfg-lo</filepath> file is excluded because it does not need to be
              changed.</info>
          </substep>
          <substep>
            <cmd>Rename and edit device files.</cmd>
            <info>For example, if you have a device file named <filepath>ifcfg-enp0s3</filepath>,
              use the <cmdname>mv</cmdname> command rename it to <filepath>ifcfg-eth0</filepath>,
              and then change the values of the <varname>NAME</varname> and
                <varname>DEVICE</varname> variables inside the file to <codeph>eth0</codeph>.</info>
          </substep>
        </substeps>
      </step>
      
      <step>
        <cmd>Update the default route.</cmd>
        <substeps>
          <substep>
            <cmd>Display the current default route.</cmd>
            <stepxmp>
              <codeblock>ip route show | head -n 1</codeblock>
            </stepxmp>
            <stepresult>Example result, showing device <codeph>enp0s3</codeph>
              and gateway host <codeph>198.51.100.1</codeph>:
              <codeblock>default via 198.51.100.1 dev enp0s3  proto static  metric 100</codeblock>
            </stepresult>
          </substep>
          <substep>
            <cmd>Update the network device.</cmd>
            <stepxmp>Replace <varname>Device-Name</varname> with the name of the device to update:
              <codeblock>ip link set <varname>Device-Name</varname> down ; \
  ip link set <varname>Device-Name</varname> name eth0 ; ip link set eth0 up</codeblock>
            </stepxmp>
            <info>To maintain your terminal session, perform the preceding commands as shown.</info>
          </substep>
          <substep>
            <cmd>Update the default route.</cmd>
            <stepxmp>Replace <varname>Gateway-Address</varname> 
              with the IP address of the gateway host:
              <codeblock>ip route replace default via <varname>Gateway-Address</varname> dev eth0</codeblock>
            </stepxmp>
          </substep>
        </substeps>
      </step>
      
      <step>
        <cmd>Reboot the host.</cmd>
      </step>
    </steps>
  </taskbody>
</task>
