<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE task PUBLIC "urn:pubid:zenoss.com:doctypes:dita:dtd:task" "task.dtd">
<task id="taskid">
  <title>Configuring the master host</title>
  <taskbody>
    <context>Use this procedure to configure a ZooKeeper cluster on the master host.</context>
    <steps>
      
      <step>
        <cmd>Log in to the master host <ph conkeyref="strings/login-root"/>.</cmd>
      </step>
      
      <step>
        <cmd>Define the IP address variables for each node in the ZooKeeper cluster.</cmd>
        <stepxmp>Replace <varname>Master-Host-IP</varname> with the IP address 
          of the <ph keyref="nm-cc"/> master host, 
          and replace <varname>Agent-Host-A-IP</varname> and
          <varname>Agent-Host-B-IP</varname> with the IP addresses 
          of the agent hosts to include in the cluster:
          <codeblock>node1=<varname>Master-Host-IP</varname>
node2=<varname>Agent-Host-A-IP</varname>
node3=<varname>Agent-Host-B-IP</varname></codeblock>
        </stepxmp>
      </step>
      
      <step>
        <cmd>Set the ID of this node in the ZooKeeper cluster to <codeph>1</codeph>.</cmd>
        <stepxmp>
          <codeblock>echo "SERVICED_ISVCS_ZOOKEEPER_ID=1" &#62;&#62; /etc/default/serviced</codeblock>
        </stepxmp>
      </step>
      
      <step>
        <cmd>Specify the hosts in the ZooKeeper cluster.</cmd>
        <stepxmp>You may copy the following text from this document and paste it in your console:
          <codeblock>echo "SERVICED_ZK=${node1}:2181,${node2}:2181,${node3}:2181" \
  &#62;&#62; /etc/default/serviced</codeblock></stepxmp>
      </step>
      
      <step>
        <cmd>Specify the hosts in the ZooKeeper quorum.</cmd>
        <info>ZooKeeper requires a unique quorum definition for each node in its cluster.
          To achieve this, replace the IP address of the master host with 0.0.0.0.</info>
        <stepxmp>You may copy the following of text and paste it in your console:
          <codeblock>q1="1@0.0.0.0:2888:3888"
q2="2@${node2}:2888:3888"
q3="3@${node3}:2888:3888"
echo "SERVICED_ISVCS_ZOOKEEPER_QUORUM=${q1},${q2},${q3}" \
  &#62;&#62; /etc/default/serviced</codeblock></stepxmp>
      </step>
      
      <step>
        <cmd>Verify the ZooKeeper environment variables.</cmd>
        <stepxmp>
          <codeblock>egrep '^[^#]*SERVICED' /etc/default/serviced | egrep '_Z(OO|K)'</codeblock>
        </stepxmp>
        <stepresult>The following example shows the environment
          variables for a master host with IP address 198.51.100.135.
          <note>The value of the <varname>SERVICED_ISVCS_ZOOKEEPER_QUORUM</varname>
          variable is formatted to fit the available space. The result of
          the <cmdname>egrep</cmdname> command shows the variable and 
            value on the same line.</note>
          <codeblock>SERVICED_ISVCS_ZOOKEEPER_ID=1
SERVICED_ZK=198.51.100.135:2181,198.51.100.136:2181,198.51.100.137:2181
SERVICED_ISVCS_ZOOKEEPER_QUORUM=1@0.0.0.0:2888:3888,\
  2@198.51.100.136:2888:3888,3@198.51.100.137:2888:3888</codeblock>
        </stepresult>
      </step>
    </steps>
  </taskbody>
</task>















